package {{domain}}.{{lib_name}};

import {{domain}}.{{lib_name}}.ntv.*;

import java.lang.foreign.Arena;
import java.lang.foreign.MemorySegment;
import java.lang.ref.Cleaner;
import java.lang.foreign.SegmentAllocator;
import java.util.List;
import static java.lang.foreign.ValueLayout.*;
import java.nio.charset.StandardCharsets;
import java.util.stream.Stream;

public class {{type_name}} {
    {% for field in fields -%}
    {{field.ty}} {{field.name}};
    {% endfor %}

    SegmentAllocator arena;
    List<Object> selfEdges = List.of();
    {% for edge in edges -%}
    List<Object> {{edge}}Edges = List.of();
    {% endfor %}

    private {{type_name}}(SegmentAllocator arena) {
        this.arena = arena;
    }

    {{type_name}}(SegmentAllocator arena, MemorySegment structSegment
    {%- for edge in edges -%}
    , List<Object> {{edge}}Edges
    {%- endfor -%}
    ) {
        this.arena = arena;
        this.selfEdges = selfEdges;
        {% for edge in edges -%}
        this.{{edge}}Edges = {{edge}}Edges;
        {% endfor %}

        {% for field in fields -%}
        this.{{field.name}} = {{field.field_val}};
        {% endfor %}

    }

    {% if is_zst -%}
    {% else -%}
    MemorySegment toNative(SegmentAllocator arena) {
        var returnVal = {{domain}}.{{lib_name}}.ntv.{{type_name}}.allocate(arena);
        
        {% for field in fields -%}
        {{domain}}.{{lib_name}}.ntv.{{type_name}}.{{field.native_name}}(returnVal, {{field.to_native}});
        {% endfor %}

        return returnVal;

    }
    {% endif -%}

    {% for method in methods %}
    {{method|indent(4)}}
    {% endfor %}
}


